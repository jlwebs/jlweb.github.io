---
layout: post
title: "2023-12-10-c++11-æ–°ç‰¹æ€§"
date: 2023-12-10
categories: jekyll
tags: ['output']
comments: true
---

---
layout: post
title: "C++11 æ–°ç‰¹æ€§"
date: 2023-12-10
categories: jekyll
tags: ['ğŸ¥-CPP']
comments: true
---

#### 1.lambda ä»¿å‡½æ•°
   1. ç±»æ¨¡æ‹Ÿlambda
```cpp
auto make_lambda(int a, int b)
{
    class Lambda {
    public:
    int operator()(int x) const {
        return a * x + b;
    }
};
    return Lambda{};
} 
```

   2. é—­åŒ…[]å†…å‡ ç§ä¼ é€’æ–¹å¼
      1. [var] å€¼ä¼ é€’å¤–éƒ¨å˜é‡var
      2. [&] å…¨éƒ¨å¤–éƒ¨å˜é‡å¼•ç”¨æ–¹å¼æ•è·
      3. [=] å…¨éƒ¨å¤–éƒ¨å˜é‡å€¼ä¼ é€’æ•è·
      4. [] åŒ¿åæ–¹å¼æ•è·ï¼Œä¸ä¼šä¿ç•™æ”¹åŠ¨
   3. lambdaå’Œmutableç»“åˆä¾‹å­
      1. æ¨¡ä»¿pythonçš„yieldåŠŸèƒ½

mutableä½œç”¨æ˜¯æŠŠå€¼ä¼ é€’æ•è·åˆ›å»ºçš„ä¸´æ—¶const å‰¯æœ¬ï¼Œé€šè¿‡mutableè®¾ç½®æ˜“å˜æ€§ï¼Œä½¿å…¶å¯ä¿®æ”¹åŒæ—¶å¢å¼ºäº†å®ƒçš„ç”Ÿå‘½å‘¨æœŸä½œç”¨åŸŸã€‚
```cpp
#include <iostream>
#include <functional>

std::function<int()> gen_one2ten() {
    int i = 0;
    // è¿”å›çš„æ˜¯çœŸæ­£çš„ç”Ÿæˆå™¨
    // æ³¨æ„ mutable å…³é”®å­—ä»¥å…è®¸åŒ¿åå‡½æ•°ä¿®æ”¹å¤–é¢çš„å±€éƒ¨å˜é‡
    // è¡¨ç°å‡ºæ¥çš„æ•ˆæœä¸ºå˜é‡ i çš„å€¼åœ¨åŒ¿åå‡½æ•°çš„å¤šæ¬¡è°ƒç”¨ä¹‹é—´ä¼šè¢«ä¿ç•™
    return [=]() mutable {
        if (i < 10) {
            i++;
            return i;
        } else {
            // è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼è¡¨ç¤ºåœæ­¢ç»§ç»­ç”Ÿæˆ
            return -1;
        }
    };
}

int main() {
    std::function<int()> one2ten = gen_one2ten();
    int x;
    while ((x = one2ten()) != -1) {
        std::cout << x << std::endl;
    }
    return 0;
}
```

#### 2.æ™ºèƒ½æŒ‡é’ˆï¼šshared_ptrã€weak_ptrã€unique_ptr
weak_ptr:
 	weak_ptrè¢«è®¾è®¡ä¸ºä¸shared_ptrå…±åŒå·¥ä½œï¼Œå¯ä»¥ä»ä¸€ä¸ªshared_ptræˆ–è€…å¦ä¸€ä¸ªweak_ptrå¯¹è±¡æ„é€ ï¼Œè·å¾—èµ„æºçš„è§‚æµ‹æƒã€‚ä½†weak_ptræ²¡æœ‰å…±äº«èµ„æºï¼Œå®ƒçš„æ„é€ ä¸ä¼šå¼•èµ·æŒ‡é’ˆå¼•ç”¨è®¡æ•°çš„å¢åŠ ã€‚åŒæ ·ï¼Œåœ¨weak_ptrææ„æ—¶ä¹Ÿä¸ä¼šå¯¼è‡´å¼•ç”¨è®¡æ•°çš„å‡å°‘ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªé™é™åœ°è§‚å¯Ÿè€…ã€‚weak_ptræ²¡æœ‰é‡è½½operator*å’Œ->ï¼Œè¿™æ˜¯ç‰¹æ„çš„ï¼Œå› ä¸ºå®ƒä¸å…±äº«æŒ‡é’ˆï¼Œä¸èƒ½æ“ä½œèµ„æºï¼Œè¿™æ˜¯å®ƒå¼±çš„åŸå› ã€‚ä½†å®ƒå¯ä»¥ä½¿ç”¨ä¸€ä¸ªéå¸¸é‡è¦çš„æˆå‘˜å‡½æ•°lock()ä»è¢«è§‚æµ‹çš„shared_ptrè·å¾—ä¸€ä¸ªå¯ç”¨çš„shared_ptrå¯¹è±¡ï¼Œä»è€Œæ“ä½œèµ„æºã€‚
weak_ptrç”¨äºè§£å†³â€å¼•ç”¨è®¡æ•°â€æ¨¡å‹å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œweak_ptræŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸å¢å‡è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ã€‚weak_ptrç”¨äºé…åˆshared_pträ½¿ç”¨ï¼Œå¹¶ä¸å½±å“åŠ¨æ€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³å…¶å­˜åœ¨ä¸å¦å¹¶ä¸å½±å“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ã€‚weak_ptrå¹¶æ²¡æœ‰é‡è½½operator->å’Œoperator *æ“ä½œç¬¦ï¼Œå› æ­¤ä¸å¯ç›´æ¥é€šè¿‡weak_pträ½¿ç”¨å¯¹è±¡ã€‚weak_ptræä¾›äº†expired()ä¸lock()æˆå‘˜å‡½æ•°ï¼Œå‰è€…ç”¨äºåˆ¤æ–­weak_ptræŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å·²è¢«é”€æ¯ï¼Œåè€…è¿”å›å…¶æ‰€æŒ‡å¯¹è±¡çš„shared_ptræ™ºèƒ½æŒ‡é’ˆ(å¯¹è±¡é”€æ¯æ—¶è¿”å›â€ç©ºâ€shared_ptr)ã€‚
shared_ptr:
å…±äº«è®¡æ•°ï¼Œå­˜åœ¨å¾ªç¯å¼•ç”¨ä¸èƒ½é‡Šæ”¾é—®é¢˜ï¼ˆå¾ªç¯å¼•ç”¨çš„å„ä¸ªå¯¹è±¡å½“ä¸€å¹¶ä¸å†ä½¿ç”¨æ—¶å€™ï¼Œæ— æ³•æ•´ä½“é‡Šæ”¾ï¼‰ï¼Œæ‰€ä»¥å¾ªç¯å¼•ç”¨æ—¶å€™æ”¹ç”¨weak_ptrã€‚
shared_ptr çš„å¼•ç”¨è®¡æ•°ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¢åŠ ï¼š
1.é€šè¿‡ shared_ptr æ‹·è´æ„é€ å‡½æ•°æˆ–èµ‹å€¼è¿ç®—ç¬¦åˆ›å»ºæ–°çš„ shared_ptr å¯¹è±¡æ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¼šå¢åŠ ã€‚
2.é€šè¿‡ make_shared æˆ– shared_ptr æ„é€ å‡½æ•°åˆ›å»ºæ–°çš„ shared_ptr å¯¹è±¡æ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¼šå¢åŠ ã€‚
3.åœ¨ä½¿ç”¨ shared_ptr ç®¡ç†çš„å¯¹è±¡ä¸­ï¼Œå¦‚æœæˆå‘˜å˜é‡æ˜¯æŒ‡å‘å †ä¸Šçš„å¯¹è±¡çš„ shared_ptrï¼Œåˆ™è¿™äº› shared_ptr å¼•ç”¨è®¡æ•°ä¼šå¢åŠ ã€‚
4.åœ¨ä½¿ç”¨ shared_ptr ç®¡ç†çš„å¯¹è±¡ä¸­ï¼Œå¦‚æœæˆå‘˜å‡½æ•°è¿”å›æŒ‡å‘å †ä¸Šçš„å¯¹è±¡çš„ shared_ptrï¼Œåˆ™è¿”å›çš„ shared_ptr å¼•ç”¨è®¡æ•°ä¼šå¢åŠ ã€‚

auto_ptr: C99é—ç äº†ï¼Œéœ€è¦äº†è§£ä¸‹å‰ä¸–ä»Šç”Ÿï¼š
ï¼ˆå¾…å†çœ‹ï¼‰

#### 3.ç»“æ„åŒ–ç»‘å®šï¼ˆc++17ï¼‰
for( auto& [key, val] : map) {...}
keyå’Œval**ä¸æ˜¯å˜é‡**ï¼Œåªæ˜¯ä¸€ç§åˆ«åã€‚
æ³¨æ„å½“æˆ‘ä»¬ä½¿ç”¨å¼•ç”¨æ—¶å€™ï¼Œä¸æ˜¯æŠŠmapå†…æ¯ä¸ªpair<>å…·ä½“çš„keyï¼Œvalueå¼•ç”¨ï¼Œè€Œæ˜¯ç±»ä¼¼äº
key= &pair->first, val= &pair->second;
å› æ­¤ä¸€æ—¦&pairåœ°å€å¤„æ”¹å˜äº†ï¼Œkeyå’Œvalä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚
ä¸€ä¸ªå¾ˆå®¹æ˜“è§¦å‘çš„ä¾‹å­ï¼š
stack<pair<A,B>> stk;
auto& [a, b] = stk.top();
stk.pop(); //popåå¹¶ä¸ä¼šç«‹å³æ¸…ç©ºæ ˆé¡¶å…ƒç´ ï¼Œè€Œæ˜¯æŠŠè¯¥ä½ç½®æ ‡è®°ä¸ºæœªä½¿ç”¨
//æ­¤æ—¶aå’Œbè¿˜èƒ½è®¿é—®åŸå§‹æ•°æ®ï¼Œä½†å½“æˆ‘ä»¬
stl.push({C,D}); //è¿™æ—¶aï¼Œbç«‹é©¬æ”¹å˜äº†ã€‚a=C, b=Dï¼›
//å› ä¸ºa,b=&pair->first,&pair->second, &pairçš„åœ°å€å·²ç»è¢«æ–°æ¥çš„{C,D}è¦†ç›–äº†ã€‚
ã€ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»å…¸é”™è¯¯ä¾‹å­çš„é”™è¯¯traceè¿‡ç¨‹ã€‘
![image.png](images/1686565277637-3e68648c-b345-4de3-8ebc-ef1daf742e74.png)
#### 4.moveç§»åŠ¨è¯­ä¹‰å’Œç§»åŠ¨æ„é€ å‡½æ•°
[C++å¼•ç”¨æŠ˜å ä¸std::moveå’Œstd::forwardçš„å®ç°](https://zhuanlan.zhihu.com/p/580797507)

- ç§»åŠ¨æ„é€ å‡½æ•°ï¼š
```cpp
class MyClass {
public:
    MyClass(MyClass&& other) noexcept {
        // å°†otherçš„èµ„æºè½¬ç§»åˆ°å½“å‰å¯¹è±¡ä¸­
        // ç¡®ä¿otherçš„èµ„æºä¸å†ä½¿ç”¨
        // å¦‚æœæºå¯¹è±¡ç±»ä¸­åŒ…å«æŒ‡é’ˆç±»å‹å˜é‡ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®other.pointer = nullptrï¼›
        // é¿å…ä¸€ç§æƒ…å†µï¼šå½“æˆ‘moveè¯­ä¹‰å®Œæˆèµ„æºè½¬ç§»åï¼Œæˆ‘æ‰‹åŠ¨å¯¹åŸå§‹å¯¹è±¡ææ„ï¼Œä¼šæŠŠæŒ‡å‘å†…å®¹æ„å¤–æ¸…é™¤ã€‚
    }
};
```

- moveç§»åŠ¨è¯­ä¹‰

å¼ºè¡Œå·¦å€¼å¼•ç”¨è½¬ä¸ºå³å€¼**å¼•ç”¨**ï¼Œ~~å¯ä»¥å®ç°æ¶ˆäº¡å€¼çš„æ•°æ®æŒä¹…åŒ–~~
åŸå‹ï¼š
```cpp
template <typename T>
typename remove_reference<T>::type&& move(T&& t)
{
	return static_cast<typename remove_reference<T>::type &&>(t);
}
```
##### å³å€¼å¼•ç”¨æº¯æº
å³å€¼å¼•ç”¨(rvalue-reference)ä¸å¤åˆ¶çœç•¥(Copy Elision)
ä»¥C++14åŠä»¥å‰çš„æ ‡å‡†æ¥è¯´ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¦‚æœç›´æ¥ç”¨ä¸€ä¸ªå˜é‡æ¥æ¥æ”¶è¿”å›å€¼ï¼Œä¼šå¤šä¸€æ¬¡ä¸´æ—¶å¯¹è±¡çš„æ‹·è´å’Œææ„ï¼Œç”¨å¸¸å¼•ç”¨è™½ç„¶å¯ä»¥å‡å°‘è¿™ä¸€æ¬¡æ‹·è´ï¼Œä½†å¸¸å¼•ç”¨æ˜¯ç”¨constä¿®é¥°çš„ï¼Œä¸å¯ä¿®æ”¹ï¼ˆå¦‚æœè¦ä¿®æ”¹çš„è¯ï¼Œè¿˜æ˜¯å¾—å†å»æ‹·è´æ„é€ ä¸€ä¸ªæ–°çš„å˜é‡ï¼‰ã€‚è€Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒC++å¼•å…¥äº†ã€Œå³å€¼å¼•ç”¨ã€ã€‚
  0.å³ä¾¿å˜é‡çš„ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œç”±å®ƒåå­—ç»„æˆçš„è¡¨è¾¾å¼ä»ç„¶æ˜¯å·¦å€¼è¡¨è¾¾å¼ã€‚

1. å¯¹äºéå¹³å‡¡ç±»å‹ï¼Œä¸ºäº†ä¿è¯å¯¹è±¡çš„è¡Œä¸ºå®Œæ•´æ€§ï¼Œå‡½æ•°è¿”å›å€¼ä¼šå•ç‹¬ä½œä¸ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œå¦‚æœéœ€è¦åœ¨æ ˆä¸Šä½¿ç”¨ï¼Œé‚£ä¹ˆä¼šæ‹·è´ç»™æ ˆä¸Šçš„å˜é‡ã€‚
2. ä¸ºäº†å¸Œæœ›è¿™ç‰‡ä¸´æ—¶ç©ºé—´èƒ½å¤Ÿè¢«ä»£ç æ•è·åˆ°ï¼Œäºæ˜¯å…è®¸äº†ç”¨å¸¸å¼•ç”¨æ¥ç»‘å®šå‡½æ•°è¿”å›å€¼ã€‚ä½†å¦‚æœè¿™æ—¶è¿”å›å€¼ä»ç„¶ä¿æŒxvalueçš„ç‰¹æ€§çš„è¯ï¼Œä¼šå¼•å…¥é‡æŒ‡é’ˆé—®é¢˜ï¼Œè¿èƒŒäº†ã€Œå¼•ç”¨ä¸´æ—¶ç©ºé—´ã€çš„åŸæ„ï¼Œå› æ­¤ä¸å¾—ä¸å°†è¿™ç§æƒ…å†µæ”¹æˆlvalueï¼Œè®©å¸¸å¼•ç”¨æ‰€å¼•ç”¨çš„ç©ºé—´è·Ÿéšå…¶æ‰€åœ¨çš„æ ˆç©ºé—´æ¥ã€Œå»¶é•¿ã€å£°æ˜å‘¨æœŸã€‚
3. åˆå› ä¸ºå¸¸å¼•ç”¨æœ‰constä¿®é¥°ï¼Œä¸èƒ½ä¿®æ”¹å¯¹è±¡ï¼Œå› æ­¤å¼•å…¥äº†ã€Œå³å€¼å¼•ç”¨ã€ï¼Œå½“ç”¨å³å€¼å¼•ç”¨ç»‘å®šå‡½æ•°è¿”å›å€¼æ—¶ï¼Œè¡Œä¸ºè·Ÿå¸¸å¼•ç”¨æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥å‡å°‘ä¸€æ¬¡xvalueçš„ç”Ÿæˆï¼Œã€Œå»¶é•¿ã€å£°æ˜å‘¨æœŸï¼ŒåŒæ—¶è¿˜å¯ä»¥ä¿®æ”¹å¯¹è±¡ã€‚
4. åˆå‘ç°è¿˜æ˜¯ç›´æ¥ç”¨å˜é‡æ¥æ¥æ”¶å‡½æ•°è¿”å›å€¼æ›´åŠ ç›´è§‚ã€ç¬¦åˆç›´è§‰ï¼Œè€Œè¿™ç§æƒ…å†µä¸‹xvalueçš„ç”Ÿæˆå¹¶æ²¡æœ‰å¤ªå¤§çš„å¿…è¦ï¼Œå› æ­¤åˆè§„å®šäº†ã€Œå¤åˆ¶çœç•¥ã€ï¼Œæ¥ä¼˜åŒ–è¿™ä¸€æ¬¡å¤åˆ¶ã€‚ï¼ˆä¼˜åŒ–ä¹‹åï¼Œç”¨å˜é‡æ¥æ”¶å‡½æ•°è¿”å›å€¼å’Œç”¨å³å€¼å¼•ç”¨æ¥æ”¶å‡½æ•°è¿”å›å€¼å°±å®Œå…¨æ²¡æœ‰åŒºåˆ«äº†ï¼›è€Œç”¨constå˜é‡æ¥æ”¶å‡½æ•°è¿”å›å€¼è·Ÿç”¨å¸¸å¼•ç”¨æ¥æ”¶å‡½æ•°è¿”å›å€¼ä¹Ÿæ²¡æœ‰åŒºåˆ«äº†ã€‚ï¼‰

è¿™é‡Œéœ€è¦é¢å¤–è§£é‡Šä¸€ä¸‹ï¼Œä¸Šé¢çš„å®ä¾‹æˆ‘ä»¬éƒ½æ·»åŠ äº†-fno-elide-constructorsè¿™ä¸ªç¼–è¯‘å‚æ•°ï¼Œå…¶å®å®ƒå°±æ˜¯ç”¨äºå…³é—­ç¼–è¯‘å™¨çš„è‡ªåŠ¨å¤åˆ¶çœç•¥çš„ã€‚åœ¨C++17ä»¥å‰ï¼Œè™½ç„¶è¯­è¨€æ ‡å‡†æ˜¯æ²¡æœ‰å®šä¹‰å¤åˆ¶çœç•¥çš„ï¼Œä½†ç¼–è¯‘å™¨æ—©æ—©å°±å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯åšäº†ä¸€äº›å®šåˆ¶åŒ–çš„ä¼˜åŒ–ï¼ˆç§°ä¸ºè¿”å›å€¼ä¼˜åŒ–ï¼ŒReturn Value Optimizationï¼Œæˆ–RVOï¼‰ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å…³é—­RVOï¼Œå®Œå…¨æŒ‰ç…§è¯­è¨€æ ‡å‡†æ¥è¿›è¡Œç¼–è¯‘ã€‚è€Œåœ¨C++17æ ‡å‡†ä¸­ï¼Œå®šä¹‰äº†å¤åˆ¶çœç•¥çš„æ–¹å¼ï¼Œå› æ­¤ç¼–è¯‘å™¨å°±å¿…é¡»æŒ‰ç…§è¯­è¨€æ ‡å‡†å®šä¹‰çš„é‚£æ ·æ¥å¤„ç†è¿”å›å€¼äº†ï¼Œæ‰€ä»¥åœ¨C++17æ ‡å‡†ä¸‹ï¼Œè¿™ä¸ªç¼–è¯‘å‚æ•°ä¹Ÿå°±ä¸å†ç”Ÿæ•ˆäº†ã€‚
[C++ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šéš¾æçš„å€¼ç±»åˆ«ï¼Ÿï¼ˆä¸‹ï¼‰](https://www.dgrt.cn/a/321756.html?action=onClick)
#### 5.è¡¨è¾¾å¼å€¼ç±»åˆ«
glvalueã€rvalueï¼šéƒ½æ˜¯generalizedï¼Œå¹¿ä¹‰å·¦å€¼ã€å¹¿ä¹‰å³å€¼ï¼Œå› ä¸ºåŒ…å«äº†xvalue
xvalueï¼šexpired valueï¼Œæ¶ˆäº¡å€¼ï¼Œå¸¸å¸¸æ˜¯ä¸´æ—¶è¡¨è¾¾å¼ï¼Œå¦‚å®å‚é‡Œçš„æ–°å¯¹è±¡ï¼›
pure rvalue = prvalueï¼š çº¯å³å€¼å’Œlvalueç±»ä¼¼
> å®ƒå’Œlvalueçš„åŒºåˆ«å°±åœ¨äºå³å°†æ¶ˆäº¡ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯æœ‰èº«ä»½çš„ï¼Œå…¶å®å°±æ˜¯å³å°†æ¶ˆäº¡çš„lvalueï¼Œè¡¨æ˜è¿™ç±»å¯¹è±¡çš„èµ„æºæ˜¯å¯ä»¥è¢«å¤ç”¨çš„

![](images/1686736779695-d9e29e79-8f03-4e49-ab8a-235cc5167e14.png)
> C++çš„è¡¨è¾¾å¼çš„å®šä¹‰ï¼šç”±å„ç§è¿ç®—å¯¹è±¡ï¼ˆoperandsï¼‰å’Œè¿ç®—ç¬¦ï¼ˆoperators ï¼‰ç»„æˆçš„è¡¨æ˜ä¸€ä¸ªè®¡ç®—çš„å¼å­ï¼Œæ¯”å¦‚a + bæˆ–a.method(1) + bè¿™ç§ï¼Œä½†è¿™é‡Œæƒ³è¦é¢å¤–å¼ºè°ƒçš„æ˜¯ï¼Œå³ä¾¿æ²¡æœ‰é¢å¤–çš„è¿ç®—ç¬¦ï¼Œ"hello word"è¿™ç§[å­—é¢é‡](https://so.csdn.net/so/search?q=%E5%AD%97%E9%9D%A2%E9%87%8F&spm=1001.2101.3001.7020)ä»¥åŠå•ä¸ªå˜é‡åvarä¹Ÿå±äºè¡¨è¾¾å¼ã€‚

ä¸‰ç§åŸºæœ¬å€¼ç±»å‹çš„ä»£è¡¨ç§ç±»
lvalueï¼šå˜é‡ï¼ˆåŒ…æ‹¬å³å€¼å¼•ç”¨ç±»å‹çš„ï¼‰ã€å‡½æ•°ï¼ˆè¿”å›å·¦å€¼å¼•ç”¨çš„å‡½æ•°ï¼‰ã€æ•°æ®æˆå‘˜
æ•°æ®æˆå‘˜ã€æ•°ç»„å
:::success
ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²å­—é¢å€¼â€œhelloâ€æ˜¯å·¦å€¼ï¼š å­—ç¬¦ä¸²å­—é¢é‡å¯ä»¥è®¤ä¸ºç±»å‹æ˜¯æ•°ç»„ï¼Œå½“æ•°ç»„å‡ºç°åœ¨è¡¨è¾¾å¼ä¸­ï¼Œ æ ¹æ®å€¼è½¬å˜æ¦‚å¿µæˆ‘ä»¬å¯çŸ¥æ— è®ºæ˜¯å·¦å€¼æ•°ç»„æˆ–æ˜¯å³å€¼æ•°ç»„éƒ½ä¼šè‡ªåŠ¨è½¬å˜æˆå³å€¼æŒ‡é’ˆã€‚ä¹‹æ‰€ä»¥å®šä¹‰ä¸ºå·¦å€¼å¯èƒ½ä»…ä»…æ˜¯å§”å‘˜ä¼šçš„å–œå¥½ã€‚
Cè¯­è¨€ä¸­,å­—ç¬¦ä¸²å­—é¢é‡å±äº const char *,æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡,æ‰€ä»¥ä¸æ˜¯å·¦å€¼ï¼Œä½†åœ¨C++ä¸­,å­—ç¬¦ä¸²å­—é¢é‡çš„ç±»å‹æ˜¯const char[N],æ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„,æ‰€ä»¥æ˜¯å·¦å€¼ã€‚
tipsï¼šå‡¡æ˜¯èƒ½ç”¨&å–å€çš„è¡¨è¾¾å¼éƒ½æ˜¯å·¦å€¼è¡¨è¾¾å¼ï¼ˆä½å­—æ®µã€å¯„å­˜å™¨å˜é‡é™¤å¤–ï¼‰
:::

prvalueï¼šå•çº¯è¿”å›å³å€¼çš„è®¡ç®—è¡¨è¾¾å¼ã€å–åœ°å€ã€å­—ç¬¦ä¸²ä»¥å¤–å­—é¢é‡
xvalueï¼š

- è¿”å›**ç±»å‹æ˜¯**å¯¹è±¡çš„**å³å€¼å¼•ç”¨**çš„**å‡½æ•°**æˆ–è€…é‡è½½è¿ç®—ç¬¦çš„**è°ƒç”¨**ï¼Œæ¯”å¦‚æœ€å…¸å‹çš„ï¼šreturn std::move(x)
- å¾€å³å€¼å¼•ç”¨ç±»å‹è½¬çš„ç±»å‹è½¬æ¢è¡¨è¾¾å¼ï¼Œæ¯”å¦‚static_cast<char&&>(x)

[C++ å€¼ç±»åˆ«(value category)å¾ªåºæ¸è¿›ï¼ˆä¸€ï¼‰å€¼ç±»åˆ«æ˜¯ä»€ä¹ˆ_wxj1992çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/wxj1992/article/details/126734243)
å±æ€§ï¼š
lvalueï¼š 

- åˆå§‹å·¦å€¼å¼•ç”¨
- constå·¦å€¼å¼•ç”¨å¯ä»¥å®Œæˆå¼•ç”¨å³å€¼

prvalueï¼šä¸å…·æœ‰å¤šæ€
#### 6.push_backå’Œemplace_backæ€§èƒ½å·®åˆ«
è¿™é‡Œæ¢è®¨push_back(string&&) ç‰ˆæœ¬å’Œemplace_backæ¨¡æ¿å‡½æ•°ä¹‹é—´çš„æ€§èƒ½å·®è·
push_back("mystr");
emplace_back("mystr");
> **ç»“è®ºï¼šå‰è€…ç•¥æ…¢äºåè€…ï¼›å¯¹äºstringå¤§æ¦‚25%å·¦å³æ—¶é—´å·®è·**
> ![image.png](images/1688229347885-07a9beb3-2adc-4284-836f-d8779facc0ed.png)

åŸå› æ¢ç©¶ï¼š
å…ˆæ‘†å‡ºä¸¤è€…çš„æºç å®šä¹‰
```cpp
// push_back(string&&) function
void push_back(string&& value) {
    // å¦‚æœå®¹å™¨çš„å¤§å°å·²ç»è¾¾åˆ°äº†å®¹å™¨çš„å®¹é‡ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹
    if (size_ + 1 > capacity_) {
        reserve(capacity_ == 0 ? 1 : capacity_ * 2);
    }

    // åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°å®¹å™¨çš„æœ«å°¾
    new (data_ + size_) std::string(std::move(value));
    ++size_;
}

// emplace_back(string&&) function
template <typename... Args>
void emplace_back(Args&&... args) {
    // å¦‚æœå®¹å™¨çš„å¤§å°å·²ç»è¾¾åˆ°äº†å®¹å™¨çš„å®¹é‡ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹
    if (size_ + 1 > capacity_) {
        reserve(capacity_ == 0 ? 1 : capacity_ * 2);
    }

    // åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°å®¹å™¨çš„æœ«å°¾
    new (data_ + size_) std::string(std::forward<Args>(args)...);
    ++size_;
}
```
moveæºç 
```cpp
template <typename T>
typename std::remove_reference<T>::type&& move(T&& arg) noexcept {
    return static_cast<typename std::remove_reference<T>::type&&>(arg);
}
```
forwardæºç 
```cpp
template <typename T>
constexpr T&& forward(typename std::remove_reference<T>::type& t) noexcept {
    return static_cast<T&&>(t);
}

template <typename T>
constexpr T&& forward(typename std::remove_reference<T>::type&& t) noexcept {
    static_assert(!std::is_lvalue_reference<T>::value, "template argument substituting T is an lvalue reference type");
    return static_cast<T&&>(t);
}
```
â‘  æ¨¡æ¿å¤©ç„¶å¼€é”€ä¼˜åŠ¿ï¼Œ~~æ²¡æœ‰è°ƒç”¨å‡½æ•°çš„å‚æ•°è°ƒç”¨ä¼ å‚è¿‡ç¨‹~~ï¼Œåªæ˜¯ç¼–è¯‘æ—¶æœŸè½¬æ¢
> _æ¨¡æ¿å‡½æ•°å’Œæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿä¼šåœ¨è°ƒç”¨æ—¶å°†å‡½æ•°å‚æ•°å…¥æ ˆã€‚åœ¨æ¨¡æ¿å‡½æ•°ä¸­ï¼Œç”±äºæ¨¡æ¿å‚æ•°æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œå› æ­¤ç¼–è¯‘å™¨å¯ä»¥å¯¹æ¨¡æ¿å‡½æ•°è¿›è¡Œä¼˜åŒ–ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨æ—¶çš„å¼€é”€ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚_

â‘¡ å‡½æ•°è°ƒç”¨å½¢å‚ä½œä¸ºä¸€ä¸ªtempä¸´æ—¶å˜é‡
emplace_back("mystr") è¿™é‡Œå¹¶ä¸ä¼šæœ‰temp="mystr"è¿‡ç¨‹ï¼Œæ¨¡æ¿å…¶å®ç›¸å½“äºå¤åˆ¶ä»£ç åˆ°äº†æ­¤å¤„
> _ä¸ºäº†è¾¾åˆ°æ•ˆç‡çš„æœ€å¤§åŒ–ï¼Œé¿å…å…ˆæ„é€ å†ææ„tempï¼Œå¯ä»¥è°ƒç”¨ç½®å…¥å‡½æ•°emplace_backï¼šå®ƒä½¿ç”¨ä¼ å…¥çš„ä»»ä½•å®å‚åœ¨vectorå†…æ„é€ stringï¼Œä¸æ¶‰åŠä»»ä½•ä¸´æ—¶å˜é‡ã€‚_

è§æ±‡ç¼–ï¼š[å¸¸è§ä¾‹å­æ±‡ç¼–](https://www.yuque.com/u26180163/eer926/ugbd2k0vg7b42f7t?view=doc_embed&inner=ZQu9C)
â‘¢å®Œç¾è½¬å‘å’Œmoveè°ƒç”¨å·®è·ï¼š
å®Œç¾è½¬å‘æ¨¡æ¿æ˜¯å°†åŸå§‹å‚æ•°åŒ…çš„å¼•ç”¨ç±»åˆ«åŸå°ä¸åŠ¨çš„æäº¤ç»™stringæ„é€ å‡½æ•°ï¼Œæ˜¯æ¨¡æ¿ä¸­å¸¸ç”¨è¡”æ¥ï¼Œå¦‚æœä¸ä½¿ç”¨å®Œç¾è½¬å‘ï¼Œåˆ™stringè°ƒç”¨çš„æ˜¯èµ‹å€¼æ„é€ å‡½æ•°String(string& base)ï¼Œè€Œä¸æ˜¯String(string&& other);
è€Œå‡½æ•°push_backé‡Œçš„moveå’Œå®Œç¾è½¬å‘ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯å¯¹ä¸€ä¸ªå‚æ•°è¿›è¡Œå¼ºåˆ¶è½¬æ¢ä¸ºå³å€¼ç±»å‹ï¼Œæ‰€ä»¥æ€§èƒ½å·®è·å¹¶ä¸æ˜¯è¿™é‡Œäº§ç”Ÿçš„ã€‚

---

**æ€»ç»“ï¼š **æ€§èƒ½å·®è·ä¸æ˜¯ç”±äºæºç é€»è¾‘ä¸åŒå¼•èµ·çš„ï¼Œè€Œæ˜¯æ¨¡æ¿å’Œå‡½æ•°è°ƒç”¨æœºåˆ¶ä¸Šå¯¼è‡´äº†ï¼Œpush_backå¤©ç„¶çš„å¼±åŠ¿ï¼Œä¸´æ—¶å½¢å‚**è¿™é‡Œæ˜¯xvalueç±»å‹**ï¼Œä¼šåœ¨push_backæ‰§è¡Œå®Œæˆåææ„ï¼Œè€Œemplace_backæ²¡æœ‰è¿™ä¸ªææ„æ­¥éª¤ã€‚
:::success

1. å¦‚æœå®å‚æ˜¯å·¦å€¼ï¼Œä¸”å‡½æ•°å‚æ•°ç±»å‹æ˜¯éå¼•ç”¨ç±»å‹ï¼Œåˆ™åœ¨ä¼ é€’ç»™å‡½æ•°æ—¶ä¼šè¿›è¡Œéšå¼è½¬æ¢ï¼Œäº§ç”Ÿä¸€ä¸ªprvalueã€‚
2. å‡½æ•°å‚æ•°ç±»å‹æ˜¯å·¦å€¼æˆ–è€…å³å€¼å¼•ç”¨ç±»å‹ï¼Œéƒ½å°†äº§ç”Ÿxvalue
:::

#### 7.finalã€override
> è¿™ä¸¤ä¸ªå…³é”®å­—éƒ½æœ‰åŠ©äºæé«˜ä»£ç çš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**1.override**ä¸»è¦ç”¨äºæ£€æµ‹é‡å†™è™šå‡½æ•°æ—¶å€™æ˜¯å¦å®Œæˆäº†å¯¹è™šå‡½æ•°çš„overwrite
> c++è§„å®š,å½“ä¸€ä¸ªæˆå‘˜å‡½æ•°è¢«å£°æ˜ä¸ºè™šå‡½æ•°å,å…¶æ´¾ç”Ÿç±»ä¸­çš„åŒåå‡½æ•°éƒ½è‡ªåŠ¨æˆä¸ºè™šå‡½æ•°

   - è¦æ±‚åŸºç±»æœ‰è¿™ä¸ªå‡½æ•°
   - è¦æ±‚åŸºç±»è¿™ä¸ªå‡½æ•°å¿…é¡»ä¸ºè™šå‡½æ•°

**2.final** å…³é”®å­—ç”¨äºæ ‡è®°ç±»ã€æˆå‘˜å‡½æ•°æˆ–è™šå‡½æ•°ï¼Œè¡¨ç¤ºå®ƒä»¬ä¸èƒ½è¢«å­ç±»ç»§æ‰¿æˆ–é‡å†™ã€‚è¿™æ„å‘³ç€ä½¿ç”¨ **final** ä¿®é¥°çš„ç±»ä¸èƒ½ä½œä¸ºåŸºç±»ï¼Œä½¿ç”¨ **final** ä¿®é¥°çš„è™šå‡½æ•°ä¸èƒ½å†è¢«å­ç±»é‡å†™
final å…³é”®å­—é€šå¸¸ç”¨äºä»¥ä¸‹æƒ…å†µï¼š

- é˜²æ­¢æŸä¸ªç±»è¢«ç»§æ‰¿ï¼Œä»¥ç¡®ä¿ç±»çš„ä¸å¯ä¿®æ”¹æ€§ã€‚
- é˜²æ­¢æŸä¸ªè™šå‡½æ•°è¢«è¿›ä¸€æ­¥é‡å†™ï¼Œä»¥ç¡®ä¿æ¥å£çš„ç¨³å®šæ€§
#### 8.explicitã€implicit
explicitå…³é”®å­—åªèƒ½ç”¨äºä¿®é¥°åªæœ‰ä¸€ä¸ªå‚æ•°çš„ç±»æ„é€ å‡½æ•° , å®ƒçš„ä½œç”¨æ˜¯è¡¨æ˜è¯¥æ„é€ å‡½æ•°æ˜¯æ˜¾ç¤ºçš„, è€Œééšå¼çš„,è·Ÿå®ƒç›¸å¯¹åº”çš„å¦ä¸€ä¸ªå…³é”®å­—æ˜¯implicit, æ„æ€æ˜¯éšè—çš„,ç±»æ„é€ å‡½æ•°é»˜è®¤æƒ…å†µä¸‹ä¸ºimplicit(éšå¼)
#### 9.å¯å˜å‚æ•°æ¨¡æ¿
```cpp
auto submit(F&& f,Args&&... args)->std::future<decltype(f(args...))>{

        auto taskPtr = std::make_shared<std::packaged_task<decltype(f(args...))()>>(
            std::bind(std::forward<F>(f),std::forward<Args>(args)...)
        );
    ...
}
```

#### 10.å®Œç¾è½¬å‘(forward)
```cpp
template<typename T, typename... Args>
T&& forward_helper(std::true_type, T&& t, Args&&...) noexcept {
    return std::forward<T>(t);
}

template<typename T, typename... Args>
auto forward_helper(std::false_type, T&& t, Args&&... args) noexcept -> decltype(T(std::forward<Args>(args)...), T&&()) {
    return std::forward<T>(t);
}

template<typename T, typename... Args>
decltype(auto) forward(Args&&... args) noexcept {
    return forward_helper(std::is_constructible<T, Args&&...>(), std::forward<Args>(args)...);
}
```
> æ³¨æ„å‡½æ•°æ¨¡æ¿é‡Œçš„Args&&å¹¶ä¸åªæ¥æ”¶å³å€¼ï¼Œè¿™é‡Œæœ‰ä¸ªä¸‡èƒ½å¼•ç”¨æ¦‚å¿µï¼š
_ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰æ˜¯C++ä¸­çš„ä¸€ä¸ªæ¨¡æ¿æ¦‚å¿µï¼Œæ˜¯ç”±C++æ ‡å‡†å§”å‘˜ä¼šæˆå‘˜Scott Meyersæå‡ºçš„ã€‚å®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¼•ç”¨ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªæ—¢å¯ä»¥æ˜¯å·¦å€¼åˆå¯ä»¥æ˜¯å³å€¼çš„å¯¹è±¡ã€‚_
> _ä¸‡èƒ½å¼•ç”¨å¯ä»¥é€šè¿‡auto&&æˆ–template<typename T> T&&ç­‰è¯­æ³•æ¥å®šä¹‰ã€‚åœ¨ä½¿ç”¨ä¸‡èƒ½å¼•ç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡çš„ç±»å‹å’Œå€¼ç±»åˆ«ï¼ˆå·¦å€¼æˆ–å³å€¼ï¼‰æ¥å†³å®šå…¶çœŸæ­£çš„ç±»å‹ï¼Œå³æ˜¯å·¦å€¼å¼•ç”¨ç±»å‹è¿˜æ˜¯å³å€¼å¼•ç”¨ç±»å‹ã€‚_

ä½¿ç”¨ä¾‹å­ï¼š
[C++11ç‰¹æ€§ï¼ˆè¯¦ç»†ç‰ˆï¼‰_é›¨è½©ï¼ˆçˆµä¸¶è¿¹ï¼‰çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/weixin_46873777/article/details/122948389#7_386)
ä¸ºä»€ä¹ˆè¦å®Œç¾è½¬å‘ï¼š
> å³å€¼å¼•ç”¨çš„å¯¹è±¡ï¼Œå†ä½œä¸ºå®å‚ä¼ é€’æ—¶ï¼Œå±æ€§ä¼šé€€åŒ–ä¸ºå·¦å€¼ï¼Œåªèƒ½åŒ¹é…å·¦å€¼å¼•ç”¨ã€‚ä½¿ç”¨å®Œç¾è½¬å‘ï¼Œå¯ä»¥ä¿æŒä»–çš„å³å€¼å±æ€§ï¼›ï¼ˆè§£é‡Šï¼‰C++è¯­è¨€è§„å®šï¼Œå½“å³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡ä½œä¸ºéå¸¸é‡å¼•ç”¨ç±»å‹çš„å‚æ•°ä¼ é€’æ—¶ï¼Œå…¶å±æ€§ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸ºå·¦å€¼ï¼Œä»¥ç¡®ä¿å‡½æ•°èƒ½å¤Ÿä¿®æ”¹å…¶å€¼ã€‚

#### 11.bindå‡½æ•°
[bindå‡½æ•°](https://so.csdn.net/so/search?q=bind%E5%87%BD%E6%95%B0&spm=1001.2101.3001.7020)å¯ä»¥å°†æ—¢æœ‰å‡½æ•°çš„å‚æ•°ç»‘å®šèµ·æ¥ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªå‡½æ•°å¯¹è±¡
 ` auto f = bind(func1, 1);`
 è°ƒç”¨funcå¦‚æœå½¢å‚å£°æ˜ä¸ºå¼•ç”¨ï¼Œéœ€è¦å€ŸåŠ©std::refæå–å¼•ç”¨ï¼Œå…·ä½“åŸç†è§çŸ¥è¯†åº“ï¼ˆå‡½æ•°å¼ç¼–ç¨‹ ï¼Œè¿˜æœ‰threadåˆ›å»ºä¼ å‚ä¹Ÿæ˜¯ä¸€æ ·ï¼‰
#### 12.make_sharedå‡½æ•°æ¨¡æ¿
æ™ºèƒ½æŒ‡é’ˆæœåŠ¡ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å®šç±»å‹çš„ std::shared_ptr

#### 13.mutex äº’æ–¥é‡å§‹ç¥–
> åŸºäº POSIX çš„ pthread_mutex_t å¼€å‘è€Œæ¥çš„C++åº“ï¼›
> semaphoneå’ŒmutexåŒºåˆ«ï¼ˆè¯¦è§ std::semaphoreï¼‰ï¼š
> :::success

- Semaphore æ˜¯è®¡æ•°å™¨ï¼Œè€Œ mutex æ˜¯é”
- Semaphore æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œè€Œ mutex åªèƒ½æ§åˆ¶ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®
- Semaphore å¯ä»¥ç”¨äºå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œè€Œ mutex å¯ä»¥ç”¨äºå®ç°äº’æ–¥é”

æ›´å¤šåŒºåˆ«è§:OSçŸ¥è¯†åº“â€”â€”å„ç±»é”çš„åŒºåˆ«
:::

åœ¨ C++11 ä¹‹å‰ï¼ŒC++ ä¸­åªæœ‰ std::mutex ç±»ç”¨äºäº’æ–¥é‡ç®¡ç†ã€‚std::mutex æä¾›äº†ä»¥ä¸‹æ“ä½œï¼š

- lock()ï¼šè·å–é”ã€‚ç”¨äºä¿æŠ¤æ“ä½œä¹‹å‰ï¼›
- unlock()ï¼šé‡Šæ”¾é”ã€‚ç”¨äºæ“ä½œå®Œæˆåï¼›

#### 14.ä¸€è¿›åŒ– lock_guard -> unique_lock ï¼ˆC++11ï¼‰
> ã€è¯ç”ŸåŸå› ã€‘1. ä»¥å‰çš„äº’æ–¥é‡ç®¡ç†æ–¹å¼éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨è·å–å’Œé‡Šæ”¾é”ï¼Œè¿™å®¹æ˜“å‡ºé”™ã€‚
> 2.åŠŸèƒ½æœ‰é™ï¼Œæ— æ³•æ»¡è¶³å¤æ‚åœºæ™¯çš„éœ€æ±‚ã€‚

æä¾›RAIIæœºåˆ¶ç®¡ç†äº’æ–¥é‡ï¼Œé¿å…é‡Šæ”¾é—æ¼ï¼›
**std::lock_guard** æ˜¯ std::unique_lock çš„ç®€åŒ–ç‰ˆã€‚å®ƒåœ¨æ„é€ æ—¶ä¼š**è‡ªåŠ¨åŠ é”**ï¼Œ**åªèƒ½**åœ¨ææ„æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚
**std::unique_loc**k æ˜¯è¿™å››ä¸ªç®¡ç†äº’æ–¥é‡çš„ç±»æ¨¡æ¿ä¸­æœ€**é€šç”¨**çš„ï¼Œæä¾›äº† lock()ã€unlock() å’Œ try_lock() æ–¹æ³•æ¥çµæ´»çš„è·å–ã€é‡Šæ”¾å’Œå°è¯•è·å–é”ï¼›

###### 15.å†è¿›åŒ– std::lock -> scoped_lock (C++17)
> ã€è¯ç”ŸåŸå› ã€‘ ä»¥å‰çš„äº’æ–¥é‡ç®¡ç†æ–¹å¼åªèƒ½è·å–å•ä¸ªäº’æ–¥é‡ï¼Œç°åœ¨éœ€è¦å¤šä¸ªäº’æ–¥é‡ç®¡ç†ï¼›

- std::lock å¯ä»¥æŒ‰ç…§å‚æ•°åˆ—è¡¨ä¸­çš„é¡ºåºå°è¯•è·å–å¤šä¸ªäº’æ–¥é‡ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚
- 

#### 16.condition_variable åº“
#### 17.std::futureå’Œstd::promiseå¼‚æ­¥ç¼–ç¨‹
ä¼ ç»Ÿæ–¹å¼é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†å¼‚æ­¥è¿”å›çš„ç»“æœï¼Œå¯¼è‡´ä»£ç é€»è¾‘åˆ†æ•£ä¸”éš¾ä»¥ç»´æŠ¤ã€‚
ç”¨äºåœ¨ä¸åŒçº¿ç¨‹å®Œæˆæ•°æ®ä¼ é€’ï¼ˆå¼‚æ­¥æ“ä½œï¼‰
#### 18.std::refåŸç†ï¼ˆx.xï¼‰
å‰ææ¦‚è¦ï¼š
:::success
å‡½æ•°å¼ç¼–ç¨‹é‡Œç¼–è¯‘å™¨è®¤ä¸ºå³ä½¿å¼•ç”¨å½¢å‚ä¹Ÿæ˜¯æŒ‰å€¼ä¼ é€’ï¼›
ä¾‹å¦‚ï¼šstd::thread, std::function,std::bindéƒ½éœ€è¦ç”¨std::refåŒ…è£…ä¸€å±‚
:::
> std::refå’Œstd::crefè¿™ä¸¤ä¸ªå‡½æ•°æ¨¡æ¿æ˜¯ä¸€ä¸ªç”¨æ¥äº§ç”Ÿstd::reference_wrapperï¼ˆwrapperï¼Œä¿®é¥°å™¨ è£…é¥°å™¨ï¼‰å¯¹è±¡çš„å¸®åŠ©å‡½æ•°ï¼Œé€šè¿‡ä½¿ç”¨å‚æ•°æ¨å¯¼æ¥å†³å®šè¿™ä¸ªæ¨¡æ¿å‚æ•°çš„å…·ä½“ç±»å‹
> ä¹Ÿå°±æ˜¯è¯´é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå‡½æ•°å‚æ•°è¿›è¡ŒåŒ…è£…ï¼Œé€šè¿‡å®é™…çš„å‚æ•°æ¨å¯¼ï¼Œå¾—åˆ°ä¸åŒçš„å‡½æ•°ç±»å‹

#### 19.dynamic_castå’Œstatic_cast
[C++åŸºç¡€#20ï¼šC++ä¸­çš„åŠ¨æ€å¼ºåˆ¶dynamic_cast-CSDNåšå®¢](https://blog.csdn.net/liranke/article/details/5145787)
å…±æ€§ï¼šå¯¹äºå‘ä¸Šè½¬æ¢(up)æ˜¯å®‰å…¨çš„ï¼Œåˆ‡ç‰‡æ€æƒ³å–å±€éƒ¨ï¼Œéƒ½å¯ä»¥æˆåŠŸï¼›

- dynamic_cast

åœ¨dynamic_castè¢«è®¾è®¡ä¹‹å‰ï¼ŒC++æ— æ³•å®ç°ä»ä¸€ä¸ªè™šåŸºç±»åˆ°æ´¾ç”Ÿç±»çš„å¼ºåˆ¶è½¬æ¢ã€‚dynamic_castå°±æ˜¯ä¸ºè§£å†³è™šåŸºç±»åˆ°æ´¾ç”Ÿç±»çš„è½¬æ¢è€Œè®¾è®¡çš„ã€‚
> ä¸ªäººç®€å•æ€»ç»“ï¼šdynamic_castç”¨äºåŸºç±»è½¬æ¢æˆæ´¾ç”Ÿç±»ï¼ŒåŸºç±»å¯ä»¥æ˜¯è™šåŸºç±»ä¹Ÿå¯ä»¥æ˜¯éè™šåŸºç±»ï¼Œä½†æ˜¯å†…éƒ¨å¿…é¡»è¦æœ‰è™šå‡½æ•°ï¼Œå¦‚æœå†…éƒ¨æ²¡æœ‰è™šå‡½æ•°ä¾¿æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨éè™šåŸºç±»ç»§æ‰¿

- static_cast

static_casté™æ€ç±»å‹è½¬æ¢
é™æ€ç±»å‹è½¬æ¢ï¼Œåœ¨ç¼–è¯‘æœŸé—´æä¾›ç±»å‹è½¬æ¢æ£€æŸ¥ï¼Œä¸»è¦ç”¨äºéå¤šæ€çš„åœºæ™¯ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨äºå¤šæ€çš„åœºæ™¯ï¼‰ã€‚ç›¸æ¯”è¾ƒäºCè¯­è¨€é£æ ¼å¼•å…¥äº†ä¸€äº›é™æ€çš„çº¦æŸï¼Œæ¯”å¦‚æ£€æŸ¥constå±æ€§å’Œvoliateå±æ€§ã€‚

   - error: cannot convert from pointer to base class 'Musician' to pointer to derived class 'People' because the base is virtual

è™šåŸºç±»ä¸èƒ½è½¬ä¸ºæ´¾ç”Ÿç±»ï¼Œç¼–è¯‘å¤±è´¥ï¼›

#### 20.weak_ptræ‰‹æ“ç‰ˆ
[æ™ºèƒ½æŒ‡é’ˆè¯¦ç»†è§£æ(æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨,åŸç†åˆ†æ)](https://zhuanlan.zhihu.com/p/642134340)
```cpp
template<class T>
class Weak {
private:
    //å†…éƒ¨å­˜æ”¾ä¸€ä¸ªæŒ‡å‘å…±äº«æŒ‡é’ˆçš„æŒ‡é’ˆ
    Share<T>* _shareptr = nullptr;
    //å­˜æ”¾è®¡æ•°å™¨
    Cnt<T>* _cntptr = nullptr;
public:
    //é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–è®¡æ•°å™¨ä¸º å¼•ç”¨0 å¼±æŒ‡é’ˆ1
    Weak() {
        _cntptr = new Cnt<T>(0, 1);
    }
    //æ‹·è´æ„é€  ä»¥å¼±æŒ‡é’ˆ
    Weak(const Weak<T>& ptr) {
        //æŠŠåŸæ¥è®¡æ•°å™¨é‡Šæ”¾
        this->~Weak();
        _shareptr = ptr._shareptr;
        _cntptr = ptr._cntptr;
        //å¼±æŒ‡é’ˆè®¡æ•°++
        _cntptr->Increase_weak_count();
    }
    //æ‹·è´æ„é€  ä»¥å…±äº«æŒ‡é’ˆ
    Weak(const Share<T>& ptr) {
        this->~Weak();
        //æŠŠè¯¥å…±äº«æŒ‡é’ˆçš„åœ°å€å­˜å…¥_shareptr
        _shareptr = &ptr;
        _cntptr = ptr._cntptr;
        _cntptr->Increase_weak_count();
    }
    //ææ„å‡½æ•°
    ~Weak() {
        //å¼±æŒ‡é’ˆè®¡æ•°--
        _cntptr->Decrease_weak_count();
        //é‡Šæ”¾è®¡æ•°å™¨ï¼ˆå†…éƒ¨ä¼šè‡ªå·±åˆ¤æ–­å¼±æŒ‡é’ˆè®¡æ•°æ˜¯å¦ä¸º0ï¼‰
        _cntptr->DestroyThis();
        _shareptr = nullptr;
        _cntptr = nullptr;
    }
    //æ‹·è´èµ‹å€¼
    Weak& operator=(const Weak<T>& ptr) {
        if (&ptr == this) return *this;
        this->~Weak();
        _shareptr = ptr._shareptr;
        _cntptr = ptr._cntptr;
        _cntptr->Increase_weak_count();
        return *this;
    }
    //æ‹·è´èµ‹å€¼ 
    Weak& operator=(Share<T>& ptr) {
        this->~Weak();
        _shareptr = &ptr;
        _cntptr = ptr._cntptr;
        _cntptr->Increase_weak_count();
        return *this;
    }
    //é‡ç½®
    void reset() {
        this->~Weak();
        _cntptr = new Cnt<T>(0, 1);
    }
    //äº¤æ¢
    void swap(Weak<T>& ptr) {
        Share<T>* temp_ptr = ptr._shareptr;
        ptr._shareptr = _shareptr;
        _shareptr = temp_ptr;
        Cnt<T>* temp_count = ptr._cntptr;
        ptr._cntptr = _cntptr;
        _cntptr = temp_count;
    }
    //åˆ¤æ–­å¼±æŒ‡é’ˆæ˜¯å¦æœ‰å¯¹è±¡ï¼Œæ²¡æœ‰è¿”å›true
    bool expired() {
        return 0 == _cntptr->get_use_count();
    }
    //è¿”å›å¼•ç”¨è®¡æ•°
    long use_count() {
        return _cntptr->get_use_count();
    }
    //å°†å¼±æŒ‡é’ˆè½¬åŒ–ä¸ºå…±äº«æŒ‡é’ˆï¼Œè‹¥æ²¡æœ‰å¯¹è±¡ï¼Œåˆ™å…±äº«æŒ‡é’ˆå†…éƒ¨æŒ‡é’ˆä¸ºnullptr
    Share<T> lock() {
        if (expired()) return Share<T>();
        else return *_shareptr;
    }
};
```
#### 21.enable_shared_from_thisç±» ç»§æ‰¿ä½¿ç”¨
[C++11æ–°ç‰¹æ€§ï¼šenable_shared_from_thisè§£å†³å¤§é—®é¢˜-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/2015917)
```cpp
#include <memory>
class MyClass : public std::enable_shared_from_this<MyClass> {
public:
    std::shared_ptr<MyClass> createShared() {
        return shared_from_this();
    }
};

int main() {
    // åˆ›å»º MyClass çš„æ™ºèƒ½æŒ‡é’ˆ
    std::shared_ptr<MyClass> ptr = std::make_shared<MyClass>();
    // åœ¨ MyClass çš„æˆå‘˜å‡½æ•°ä¸­è·å– shared_ptr
    std::shared_ptr<MyClass> ptrFromMember = ptr->createShared();
    // ç°åœ¨ä¸¤ä¸ª shared_ptr å…±äº«ç›¸åŒçš„å¯¹è±¡
    return 0;
}
```

