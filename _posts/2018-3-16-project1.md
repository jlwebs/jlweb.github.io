---
title: ä½¿ç”¨opencvå’Œopencv.jså®ç°è™šæ‹Ÿè¯•æˆ´ã€ç³å­”å®šä½åŠŸèƒ½ä¸­çš„ä¸€ç³»åˆ—é—®é¢˜
layout: post
tags:
  - ğŸ¤å†å²/opencv
  - ğŸ¤å†å² 
category: 
comments: true
feature: http://jlwebs.github.io/img/3.jpg
---


å› ä¸ºé¡¹ç›®éœ€è¦è™šæ‹Ÿç©¿æˆ´æ•ˆæœï¼Œäºæ˜¯å†³å®šç”¨opencvåº“ï¼Œ
ä¸€å¼€å§‹æƒ³æ³•æ˜¯ç”¨ä»¥å‰çš„c++ä»£ç æƒ³åŠæ³•åº”ç”¨åˆ°webä¸­ï¼Œç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“.soæˆ–è€…dllåœ¨å¯¹åº”å¹³å°è°ƒç”¨
ä½†è¿™æ ·å¯¹èµ„æºæ¶ˆè€—å¾ˆå¤§ï¼Œä¸”è§†é¢‘æµé«˜é¢‘ç‡è°ƒç”¨ä¹Ÿæ˜¯ä¸ç†æƒ³çš„ã€‚

é€”ä¸­è¿˜æœ‰ä¸¤ç§å¤§åŒå°å¼‚ï¼š
1.ç”¨socketè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡ç½‘ç»œæ‹‰å–å¤„ç†ç»“æœ
2.æœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶ä¼ å‚è¿è¡Œï¼Œå–å›ç”Ÿæˆæ–‡ä»¶
è¿™ä¸¤ç§æ–¹æ³•å¯¹æœåŠ¡å™¨æŸè€—éƒ½æ˜¯å¾ˆå¤§çš„ï¼Œäºæ˜¯å°±åœ¨æƒ³æœ‰æ²¡æœ‰æœ¬åœ°ç«¯è¿è¡Œçš„å‘¢ï¼Ÿ
åæ¥åˆå‘ç°äº†jsè„šæœ¬
JavaScriptå¾ˆå¥½çš„åº•å±‚æ¥è§¦èƒ½åŠ›ï¼Œä»¥åŠå¼ºå¤§è½¬æ¢èƒ½åŠ›ï¼Œè®©opencvç­‰è½»æ¾é©¾é©­
å…·ä½“åŸç†ï¼šEmscriptenï¼Œä¸€æ¬¾LLVM-to-JavaScriptçš„ç¼–è¯‘å™¨ï¼Œå°†C++çš„åº•å±‚å‡½æ•°ç¼–è¯‘æˆå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ç«¯è¿è¡Œçš„asm.jsæˆ–è€…WebAssemblyã€‚è€ŒOpenCV.jsæ˜¯é€šè¿‡è¯¥Emscriptenå°†OpenCVçš„å‡½æ•°ç¼–è¯‘è¿›asm.jsæˆ–WebAssemblyä¸­ï¼Œå¹¶æä¾›JS APIsç»™webåº”ç”¨ä½¿ç”¨ã€‚
ç±»ä¼¼çš„è¿˜æœ‰
- [tracking.js](https://trackingjs.com/ "tracking.js")
- [clmtrackr](https://github.com/auduno/clmtrackr "clmtrackr")
- [Headtrackr](https://github.com/auduno/headtrackr "Headtrackr")
- [CCV.js](https://github.com/liuliu/ccv "CCV.js")
è¿™äº›éƒ½æ˜¯åäººè„¸è¯†åˆ«çš„jsåº“ï¼Œç»è¿‡çŸ­æš‚å­¦ä¹ ç±»æ¯”ï¼Œå°†C++ä»£ç ä¸å®Œå…¨ç§»æ¤åˆ°jsè„šæœ¬
```javascript
/////////////////ä»£ç æµ‹è¯•åŒº/////////////////////////////
 let image = cv.imread('canvasOutput');//é•œæ¶
  let hand = cv.imread('canvasInput2');//é•œæ¶é»‘è†œ
  let mask = cv.imread('canvasInput2',0);
  let handok = new cv.Mat();
  let maskok = new cv.Mat();
//cv.resize (hand, handok,dsize , 0, 0, cv.INTER_LINEAR);
//cv.resize(mask, maskok, dsize , 0, 0, cv.INTER_LINEAR);
cv.imshow('canvas3', hand);
cv.imshow('canvas4', mask);
  image = cv.imread('canvasInput');
   hand = cv.imread('canvas3');
   mask = cv.imread('canvas4',0);
///////////////////////////////////////////////////////
//utils.loadImageToCanvas('glass_1.png','canvasOutput');
//utils.loadImageToCanvas('glass_1.png','canvasInput2'); //å¤åŸä»¥è¿›è¡Œç¬¬äºŒæ¬¡
//é•œæ¶ç¼©æ”¾ æ˜¾ç¤º å†è·å–è¯»å…¥ è®¾ç½®roi copyTo å±•ç¤ºåˆ°Input  
//-------------------------------------------------------
let src = cv.imread('canvasInput');
let gray = new cv.Mat();
cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);
let faces = new cv.RectVector();
let eyes = new cv.RectVector();
let faceCascade = new cv.CascadeClassifier();
let eyeCascade = new cv.CascadeClassifier();
// load pre-trained classifiers
faceCascade.load('haarcascade_frontalface_default.xml');
eyeCascade.load('haarcascade_eye.xml');
// detect faces
let msize = new cv.Size(0, 0);
faceCascade.detectMultiScale(gray, faces, 1.1, 3, 0, msize, msize);
for (let i = 0; i < faces.size(); ++i) {
    let eyesflag = 0;
    let roiGray = gray.roi(faces.get(i));
    let roiSrc = src.roi(faces.get(i));
    let point1 = new cv.Point(faces.get(i).x, faces.get(i).y);
    let point2 = new cv.Point(faces.get(i).x + faces.get(i).width,faces.get(i).y + faces.get(i).height);
    cv.rectangle(src, point1, point2, [255, 0, 0, 255]);
    // detect eyes in face ROI
    eyeCascade.detectMultiScale(roiGray, eyes);
    for (let j = 0; j < eyes.size(); ++j) {
         if(eyesflag==0)
            {    
                //æ¯ä¸ªè„¸æœ€å¤šä¸€ä¸ªçœ¼é•œï¼Œä¸”å¿…é¡»é¦–ä¸ªeyeä½ç½®å¿…é¡»åœ¨å·¦ä¸ŠåŠåŒº
                if(eyes.get(j).x<=faces.get(i).width/2 && eyes.get(j).y<=faces.get(i).height/2)
                   {
        let sizerate = (hand.rows / eyes.get(j).height) / 0.9;
		console.log(faces);
        let dsize = new cv.Size(hand.cols / sizerate, hand.rows / sizerate);
        cv.resize (hand, handok,dsize , 0, 0, cv.INTER_LINEAR);
        cv.resize(mask, maskok, dsize , 0, 0, cv.INTER_LINEAR);
                      imageROI = image.roi(new cv.Rect(faces.get(i).x+eyes.get(j).x-2-eyes.get(j).width/10*0,eyes.get(j).y+faces.get(i).y+eyes.get(j).height/4*0,handok.cols, handok.rows));
                      handok.copyTo(imageROI,maskok);
                      eyesflag+=1;
                    }
					  console.log(new cv.Point(faces.get(i).x+eyes.get(j).x,eyes.get(j).y+faces.get(i).y));
                      console.log(new cv.Point(eyes.get(j).x,faces.get(i).width/2));
             }
        let point1 = new cv.Point(eyes.get(j).x, eyes.get(j).y);
        let point2 = new cv.Point(eyes.get(j).x + eyes.get(j).width,eyes.get(j).y + eyes.get(j).height);
        cv.rectangle(roiSrc, point1, point2, [0, 0, 255, 255]);
    }
cv.imshow('canvasInput2', roiSrc);
    roiGray.delete(); roiSrc.delete();
}
cv.imshow('canvasOutput', src);
///////////////////////////////////////////////////////////
cv.imshow('canvas5', image);
////////////////////////////è¡¥å……
src.delete(); gray.delete(); faceCascade.delete();
eyeCascade.delete(); faces.delete(); eyes.delete();
image.delete();hand.delete();mask.delete();handok.delete();
maskok.delete();
```
![æ£€æµ‹å›¾](../img/2.png "é•œæ¡†æ¨¡å‹")
è¯´è¯´é€”ä¸­è¸©çš„å‘æŠŠï¼š
1.jsçŸ›ç›¾å¯¼è‡´canvasä¸åœè¿˜åŸçœ‹ä¸åˆ°åˆæˆæ•ˆæœ 
2.æ¢ç”¨addweightedå‘½ä»¤RGBé€æ˜é€šé“å‡ºé”™
3.LoadImageToCanvaså•ç‹¬æ‰§è¡Œæ‰èƒ½cv.imreadåˆ°å˜é‡
4.letå’Œvar C++ç‰ˆæœ¬çš„imreadç­‰å‘½ä»¤ä¸jsä¸åŒ
5.videoçš„autoplayå’Œæ§åˆ¶æˆªå›¾ä¸¤ç§æ–¹å¼ï¼ˆçº¯html5å’Œopencvæ–¹æ³•ï¼‰
6.ä¼˜åŒ–åŒä¸€äººè„¸ä¸‹ç³å­”å·¦ä¸ŠåŒºå®šé€‰é˜²è¯¯åˆ¤
7.æœ€ç»ˆé‡‡ç”¨çš„åˆå›¾èµ·ç‚¹åæ ‡ç®—æ³•ï¼ˆé•œæ¡†å®½åº¦1/4ï¼ˆä¸åŒå‹å·å¯èƒ½ä¸ä¸€è‡´ï¼‰ï¼‰ é«˜åº¦1/2åç§»è‡³ç³å­”å¤„ï¼‰
ç³å­”å¤„åˆ©ç”¨â†“å¦‚ä¸‹çœ¼çœ¶ä¸­å¿ƒå–å¾—

ç›®çš„æ˜¯ç²¾å‡†å®šä½çœ¼çƒ
![æ£€æµ‹å›¾](../img/1.png "å®˜æ–¹æ•™ç¨‹çš„æ£€æµ‹å›¾")
![æ£€æµ‹å›¾](../img/4.png "å¤±è´¥")
â†‘è¿™æ˜¯ä¹‹å‰ç¼©æ”¾å’Œèµ·ç‚¹ç®—æ³•æœ‰é—®é¢˜æ—¶å€™ï¼Œä¸œæ–¹å’Œè¥¿æ–¹äººç§é—´ä¸èƒ½å¾ˆå¥½çš„æ­£ç¡®ä½©æˆ´çœ¼é•œ
:weary:æ˜¯å› ä¸ºä¹‹å‰æ˜¯ä¸åœè°ƒè¯•æ¯”ä¾‹å‚æ•°çš„
> -**-æ­¤å¤„ç•™ç»™è§†é¢‘æµå¤„ç†çš„è¿‡ç¨‹æ€»ç»“-**-****

ä¸‹é¢æ˜¯å‰ç«¯è®¾è®¡ä¸­çš„æ„Ÿæ‚Ÿ

 å› ä¸ºä¸€å¥—ç³»ç»Ÿç¼ºå°‘ä¸äº†ç¾è§‚çš„å‰ç«¯è®¾è®¡ï¼Œï¼ˆå…¶å®ä¸»è¦æ˜¯åˆ‡å›¾ï¼‰
----------

### æŠ˜è…¾å‡ ç•ªï¼Œ 

`ä½¿ç”¨opencvå’Œopencv.jså®ç°è™šæ‹Ÿè¯•æˆ´ã€ç³å­”å®šä½åŠŸèƒ½ä¸­çš„ä¸€ç³»åˆ—é—®é¢˜` -  `2018/3/16 00:30:10 `