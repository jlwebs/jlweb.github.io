---
layout: post
title: "tcp socketè¿æ¥å›¾è§£"
date: 2023-12-10
categories: jekyll
tags: ['ğŸ¥-Network']
comments: true
---

![]({{site.baseurl}}/images\1699164916039-80d5750a-4145-4ae3-9879-ed9010125c2b.jpeg)![image.png]({{site.baseurl}}/images\1699164999066-cbab5b88-326e-455d-8f79-d53c06bd7b36.png)
![]({{site.baseurl}}/images\1699166025265-9f6aef88-1aa4-4883-8033-52cb895076fc.webp)![socketç¼–ç¨‹æ¥å£]({{site.baseurl}}/images\1699171093781-84c534b4-98a1-4c8c-ba6f-4ce32eecfe3a.png)
https TLSæ¡æ‰‹+ä¼šè¯å¯†é’¥è¿‡ç¨‹ ï¼ˆå›¾è§£ï¼‰![]({{site.baseurl}}/images\1699410307585-71d5cbbc-e022-4bc3-b2d1-93adf1cc3cd9.png)

- æ¡æ‰‹è¿‡ç¨‹ï¼š

å®¢æˆ·ç«¯connect å¼€å¯ç¬¬ä¸€æ¬¡æ¡æ‰‹
listen()è·å–åˆ°ç»“æœ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼Œè¿›å…¥åŠè¿æ¥é˜Ÿåˆ—
æœ€åä¸€æ¬¡ackåè¿›å…¥establishedï¼Œè¿›å…¥å…¨è¿æ¥é˜Ÿåˆ—ï¼ˆå†…æ ¸é€šè¿‡**äº”å…ƒç»„**ç»‘å®šæ‰¾åˆ°å¯¹åº”çš„åŠè¿æ¥é˜Ÿåˆ—ï¼Œç„¶åæ¬è¿ï¼‰
 

- æŒ¥æ‰‹è¿‡ç¨‹ï¼š

recvè¿”å›0ä»£è¡¨å¼€å§‹å…³é—­ï¼Œå‰ä¸¤æ¬¡æŒ¥æ‰‹å·²å®Œæˆ
close()å¼€å§‹ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼›
è¯·æ±‚å…³é—­ç«¯è¿›å…¥TIME_WAITé˜¶æ®µ
ï¼ˆä¸ºäº†æ¸…ç©ºå†å²è¿æ¥ï¼Œå¼€å¯æ–°çš„è¿æ¥![image.png]({{site.baseurl}}/images\1699168627887-4c1d9bd1-c7f7-499e-b087-7203e4df72f3.png)ï¼‰

- backlogä¸¤ç§ç†è§£
   - 1.å…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦ï¼ˆlinuxæœ€æ–°ç‰ˆæœ¬ï¼‰
   - 2.å…¨è¿æ¥+åŠè¿æ¥é˜Ÿåˆ—é•¿åº¦

[å¼‚å¸¸]

- TIME_WAITåˆ†åˆ«å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯å‡ºç°å¤§é‡ï¼Œä»€ä¹ˆåŸå› ï¼Ÿ

å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­æƒ…å†µä¸‹ï¼š é«˜å¹¶å‘+çŸ­è¿æ¥è¿‡å¤šã€‚
![image.png]({{site.baseurl}}/images\1699513050903-b3ec2cfd-a141-4025-a7d7-66acbc6064e5.png)
serverä¸»åŠ¨å…³é—­ä¸‹ï¼Œä¸»è¦æ˜¯ä»£ç é€»è¾‘é—®é¢˜ï¼Œå¯¼è‡´å¤§é‡è¿æ¥ä¸»åŠ¨å…³é—­ï¼›

- å®¢æˆ·ç«¯å‡ºç°å¤§é‡FIN_WAITåŸå› ï¼Ÿ

ç­‰åŒäºæœåŠ¡ç«¯è¿›å…¥å¤§é‡![image.png]({{site.baseurl}}/images\1699168057822-827db988-e0c3-48d4-b825-ba9e01328586.png)çŠ¶æ€ï¼Œç­‰äºæœåŠ¡ç«¯æ²¡æœ‰åŠæ—¶è°ƒç”¨closeå‡½æ•°ï¼›


[é—®é¢˜]

- èƒ½å¦TCP\UDPç»‘å®šç›¸åŒç«¯å£ä¸‹åŒæ—¶é€šä¿¡

![]({{site.baseurl}}/images\1699241415180-3366e0f3-afcc-4143-a205-3839d0c7990e.jpeg)  å¯ä»¥ï¼Œäº”å…ƒç»„åŒºåˆ«ã€‚

- ç«¯å£å¤ç”¨

æœ‰æ—¶å€™é‡å¯æœåŠ¡å™¨ä¼šå‡ºç°ï¼š**Address already in use**
è¯´æ˜è¿˜åœ¨4æ¬¡æŒ¥æ‰‹ç»“æŸåçš„Time_waité˜¶æ®µï¼›å¯ä»¥å¼€å¯ç«¯å£å¤ç”¨optionï¼š 
SO_REUSEADDR ä½œç”¨æ˜¯ï¼š**å¦‚æœå½“å‰å¯åŠ¨è¿›ç¨‹ç»‘å®šçš„ IP+PORT ä¸å¤„äºTIME_WAIT çŠ¶æ€çš„è¿æ¥å ç”¨çš„ IP+PORT å­˜åœ¨å†²çªï¼Œä½†æ˜¯æ–°å¯åŠ¨çš„è¿›ç¨‹ä½¿ç”¨äº† SO_REUSEADDR é€‰é¡¹ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹å°±å¯ä»¥ç»‘å®šæˆåŠŸ**

